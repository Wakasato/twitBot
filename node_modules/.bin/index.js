
var CronJob = require("cron").CronJob;
var moment = require('moment');
var Twit = require('twit')
var options = app.get('options')

var twitter = new Twit( {
  consumer_key        : "XXXXXXXXX" /* 各自記入 */,
  consumer_secret     : "XXXXXXXXX" /* 各自記入 */,
  access_token    : "XXXXXXXXX" /* 各自記入 */,
  access_token_secret : "XXXXXXXXX" /* 各自記入 */
});
//  stream a sample of public statuses 
// 
var stream = T.stream('user')

var cronTime = '0 0 0-14 * * *';

new CronJob({
  cronTime: cronTime,
  onTick: function () {
    tweet();
  },
  start: true
});



function tweet(){
  var message = moment().utc().add(9, 'h').format("ただいま MM月DD日 HH時mm分です。");
  console.log(message);

  T.post('statuses/update', { status: message }, function(err, data, response) {
    //console.log('Tweet!');
  });
}
// ダイレクトメッセージハンドリング
stream.on('direct_message', function(data) {
  var message = data.direct_message

  // 自分が送信したダイレクトメッセージは処理しない
  if (message.sender_id_str === options.id) return

  // エコーで返信
  var reply = { user_id: message.sender_id_str, text: message.text }
  twitter.post('direct_messages/new', reply, function(err, data, resp) {})
})